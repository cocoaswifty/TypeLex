# TypeLex - Minimalist macOS Typing Practice App

TypeLex 是一款專為 macOS 設計的極簡英文單字打字練習 App。它結合了高效能的原生打字體驗、TTS 發音以及 AI 輔助生成的內容，提供沉浸式的學習環境。

## ✨ 主要功能

*   **極致效能打字體驗**：
    *   **低延遲輸入**：利用 Apple **Observation 框架**實現精確重繪，確保打字時僅更新必要字元，即使在複雜背景下也能保持 120 FPS 的流暢響應。
    *   **無干擾設計**：支援 macOS 14+ `onKeyPress`，摒棄傳統輸入框，提供純粹的鍵盤互動。
    *   **雙重發音回饋**：單字出現時自動連續發音兩次（間隔 0.3s），強化聽覺記憶；切換單字或點擊其他內容時會立即中斷當前發音，確保聽覺體驗乾淨不重疊。
    *   **即時視覺回饋**：輸入正確顯示高亮，錯誤時以柔和紅底提示，並搭配動畫效果。
*   **AI 驅動與智慧內容**：
    *   **深度釋義**：整合 **Gemini 2.5 Flash Lite**，自動生成精確的英文釋義、IPA 音標與情境例句。
    *   **雙語對照**：特別優化的中文翻譯格式（如：「制止」某人...），幫助快速理解詞性與用法。
    *   **意境圖生成**：整合 Pollinations.ai 生成莫蘭迪色系 (Morandi) 插圖，並支援**大圖預覽**模式。
    *   **內容再生**：支援右鍵重新生成圖片或釋義，持續優化學習素材。

*   **現代化學習介面**：
    *   **高效能架構**：採用 Swift Concurrency (`.task`) 進行圖片異步加載與資源管理，滑動切換單字流暢無卡頓。
    *   **視覺層次化**：清晰區分視覺錨點（圖片）、互動區（打字）與資訊區（例句、翻譯）。
    *   **完美置中工具列**：精心設計的 ZStack 佈局，確保導航與工具列視覺平衡。

*   **單詞本管理**：
    *   **資料夾組織化**：每個單詞本擁有獨立資料夾，將 CSV 資料與 `media` (圖片、聲音) 分開存放，確保資源不混亂。
    *   **多模式練習**：支援「全部單字」、「我的最愛」與「錯誤加強」三種循環模式。
    *   **靈活匯入**：支援標準 CSV 格式、`4000 Essential English Words` 結構匯入，並**支援 .zip 壓縮檔直接匯入**，系統會自動解壓並整理資料。
    *   **離線優先**：圖片與發音優先讀取單詞本資料夾內的 `media` 目錄，無網路也能順暢練習。

*   **隱私與安全**：
    *   **Keychain 整合**：API Key 安全加密儲存。
    *   **Sandbox 支援**：透過 Security-Scoped Bookmarks 安全存取使用者授權的單字庫目錄。

## 📂 資料夾結構 (Storage Structure)

App 採用資料夾為單位的管理模式，結構如下：
```text
Documents/
├── BookName_A/
│   ├── BookName_A.csv     # 單字列表資料
│   └── media/             # 該單詞本專屬媒體資源
│       ├── apple.png
│       └── apple.mp3
└── BookName_B/
    ├── BookName_B.csv
    └── media/
```
啟動時會自動遷移舊版扁平結構檔案至此資料夾結構。

## 🛠 技術架構

*   **平台**：macOS 14.0+
*   **語言**：Swift 5.10+
*   **UI 框架**：SwiftUI (Modern Declarative Architecture)
    *   **併發安全與單例服務**：採用 **Singleton 模式** 管理 `SpeechService`，確保全域音效輸出的互斥性；ViewModel 全面採用 `@MainActor` 標記，確保所有 UI 狀態更新均在主線程安全執行。
    *   **@Observable 驅動**：全面採用 macOS 14 導入的 Observation 框架，精確追蹤屬性依賴，實現微秒級的視圖局部更新。
    *   **TypingEngine 狀態機**：純 Swift 邏輯層，完全分離 UI 狀態與打字演算法，易於測試與維護。
*   **AI 模型**：Gemini 2.5 Flash Lite (Text) + Pollinations AI (Image)
*   **資料儲存**：高效能 CSV 讀寫，支援多單詞本切換與 Security-Scoped 儲存權限。

## 🚀 如何開始

1.  **設定 API Key**：
    *   點擊右上角 **⚙️ (Settings)**，輸入 Google Gemini API Key 並儲存。

2.  **載入單字庫**：
    *   初次使用可點擊 **Load @4000 Essential Words** 載入專案內建範例。
    *   或選擇 **Import Custom Library** 匯入您的學習資料夾。

3.  **操作指南**：
    *   **打字**：直接鍵盤輸入英文單字。
    *   **導航**：`←` 上一個單字，`→` 跳過單字。
    *   **發音**：點擊單字、釋義或例句可聆聽發音。
    *   **預覽**：點擊圖片可查看大圖。
    *   **管理**：點擊右下角 ⭐ 加入收藏，左下角切換練習模式。
